"use strict";(self.webpackChunk_wso2is_console=self.webpackChunk_wso2is_console||[]).push([[4768],{24768:(e,t,o)=>{o.r(t),o.d(t,{default:()=>B});var n=o(55007),r=o(60486),a=o(40838),i=o(6833),l=o(82406),c=o(20494),s=o(50699),u=o(44194),f=o(10479),p=o(47245),d=o(96124),m=o(76271),v=o(21073),g=o(65612),w=o(29585),y=o(51835),h=o.n(y),k=o(27975),b=o.n(k),E=o(55900),W=o.n(E),S=o(21555),A=o.n(S),O=o(3621),R=o.n(O),j=o(5062),I=o.n(j),P=o(37883),V={};V.styleTagTransform=I(),V.setAttributes=A(),V.insert=W().bind(null,"head"),V.domAPI=b(),V.insertStyleElement=R();h()(P.Z,V);P.Z&&P.Z.locals&&P.Z.locals;var Z=o(7345),x=o(73567),C=o(60657),D=o(81921),U=o(6611),T=o(84063),_=o(97183);function L(e){return L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},L(e)}function M(e,t){var o="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!o){if(Array.isArray(e)||(o=H(e))||t&&e&&"number"==typeof e.length){o&&(e=o);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,l=!1;return{s:function(){o=o.call(e)},n:function(){var e=o.next();return i=e.done,e},e:function(e){l=!0,a=e},f:function(){try{i||null==o.return||o.return()}finally{if(l)throw a}}}}function N(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function Q(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?N(Object(o),!0).forEach((function(t){F(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):N(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function F(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=L(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var n=o.call(e,t||"default");if("object"!=L(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==L(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function $(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var n,r,a,i,l=[],c=!0,s=!1;try{if(a=(o=o.call(e)).next,0===t){if(Object(o)!==o)return;c=!1}else for(;!(c=(n=a.call(o)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(e){s=!0,r=e}finally{try{if(!c&&null!=o.return&&(i=o.return(),Object(i)!==i))return}finally{if(s)throw r}}return l}}(e,t)||H(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function H(e,t){if(e){if("string"==typeof e)return z(e,t);var o={}.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?z(e,t):void 0}}function z(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,n=Array(t);o<t;o++)n[o]=e[o];return n}const J=function(e){var t,o,s,d=e.approvalWorkflowDetails,m=e.approvalWorkflowId,y=e.isReadOnly,h=void 0!==y&&y,k=e.mutateApprovalWorkflowDetails,b=e["data-componentid"],E=(0,p.I0)(),W=(0,f.$)(["approvalWorkflows"]).t,S=h||(null==d?void 0:d.engine)!==D.Uf,A=(0,p.v9)((function(e){return e.config.ui.features})),O=(0,n.EV)(null==A||null===(t=A.approvalWorkflows)||void 0===t||null===(t=t.scopes)||void 0===t?void 0:t.update),R=(0,n.EV)(null==A||null===(o=A.approvalWorkflows)||void 0===o||null===(o=o.scopes)||void 0===o?void 0:o.delete),j="workflowId eq ".concat(m),I=(0,u.useRef)(null),P=(0,u.useRef)(null),V=(0,u.useRef)(null),L=$((0,u.useState)(!1),2),N=L[0],F=L[1],H=$((0,u.useState)(null),2),z=H[0],J=H[1],K=$((0,u.useState)(null),2),X=K[0],B=K[1],G=$((0,u.useState)(null),2),q=G[0],Y=G[1],ee=$((0,u.useState)(!1),2),te=ee[0],oe=ee[1],ne=$((0,u.useState)(),2),re=ne[0],ae=ne[1],ie=$((0,u.useState)(!1),2),le=ie[0],ce=ie[1],se=$((0,u.useState)(!0),2),ue=se[0],fe=se[1],pe=(0,x.M)(null,null,j),de=pe.data,me=pe.isLoading,ve=pe.error,ge=pe.mutate;(0,u.useEffect)((function(){if(de){var e=de.workflowAssociations.map((function(e){return{associationId:e.id,operation:e.operation}}));B(e)}}),[de]),(0,u.useEffect)((function(){ve&&E((0,l.V_)({description:W("approvalWorkflows:notifications.fetchWorkflowAssociations.genericError.description"),level:i.QU.ERROR,message:W("approvalWorkflows:notifications.fetchWorkflowAssociations.genericError.message")}))}),[ve]),(0,u.useEffect)((function(){if(X&&_.J){var e=_.J.filter((function(e){return X.some((function(t){return t.operation===e.value}))}));Y((function(t){return Q(Q({},t),{},{matchedOperations:e})})),fe(!e||0===e.length)}}),[X,_.J]),(0,u.useEffect)((function(){var e,t;if(d){var o=null!==(e=null===(t=d.template)||void 0===t||null===(t=t.steps)||void 0===t?void 0:t.map((function(e){var t,o={roles:[],users:[]};return null===(t=e.options)||void 0===t||t.forEach((function(e){"roles"===e.entity?o.roles=e.values:"users"===e.entity&&(o.users=e.values)})),o})))&&void 0!==e?e:[];J({configurations:{approvalSteps:o},generalDetails:{description:d.description,engine:d.engine,name:d.name},workflowOperationsDetails:{matchedOperations:[]}}),ae({approvalSteps:o})}}),[d]),(0,u.useEffect)((function(){var e;z&&le&&(null==V||null===(e=V.current)||void 0===e||e.triggerSubmit(),ce(!1))}),[z,le]);var we=function(e){var t={name:"MultiStepApprovalTemplate",steps:e.configurations.approvalSteps.map((function(e,t){return{options:[{entity:"roles",values:e.roles},{entity:"users",values:e.users}].filter((function(e){return e.values.length>0})),step:t+1}}))},o={description:e.generalDetails.description,engine:D.Uf,name:e.generalDetails.name,template:t};ye(o)},ye=function(e){(0,Z.Wt)(m,e).then((function(){null==k||k(),E((0,l.V_)({description:W("approvalWorkflows:notifications.updateApprovalWorkflow.success.description"),level:i.QU.SUCCESS,message:W("approvalWorkflows:notifications.updateApprovalWorkflow.success.message")}))})).catch((function(e){var t;null!=e&&null!==(t=e.response)&&void 0!==t&&null!==(t=t.data)&&void 0!==t&&t.detail?E((0,l.V_)({description:W("approvalWorkflows:notifications.updateApprovalWorkflow.error.description",{description:e.response.data.detail}),level:i.QU.ERROR,message:W("approvalWorkflows:notifications.updateApprovalWorkflow.error.description")})):E((0,l.V_)({description:W("approvalWorkflows:notifications.updateApprovalWorkflow.genericError.description"),level:i.QU.ERROR,message:W("approvalWorkflows:notifications.updateApprovalWorkflow.genericError.message")}))}))},he=function(e){E((0,l.V_)(e))},ke=function(e){(0,C.G)(e).then((function(){var e;ge(),null==P||null===(e=P.current)||void 0===e||e.refreshWorkflowAssociations()})).catch((function(){he({description:W("approvalWorkflows:notifications.addWorkflowAssociation.genericError.description"),level:i.QU.ERROR,message:W("approvalWorkflows:notifications.addWorkflowAssociation.genericError.description")})}))},be=function(e){(0,C.V)(e).then((function(){var e;ge(),null==P||null===(e=P.current)||void 0===e||e.refreshWorkflowAssociations()})).catch((function(){he({description:W("approvalWorkflows:notifications.deleteWorkflowAssociation.genericError.description"),level:i.QU.ERROR,message:W("approvalWorkflows:notifications.deleteWorkflowAssociation.genericError.description")})}))};return u.createElement(u.Fragment,null,u.createElement(c.pJ,{padded:"very"},me&&!d?u.createElement("div",{"data-componentid":"".concat(b,"-loading-skeleton")},u.createElement(w.Z,{component:"h1",width:"40%"}),u.createElement(w.Z,null),u.createElement("br",null),u.createElement(w.Z,{component:"h1",width:"40%"}),u.createElement(w.Z,null)):u.createElement(u.Fragment,null,u.createElement("div",{className:"workflow-model-general-settings"},u.createElement(T.Z,{ref:I,isReadOnly:S||!O,initialValues:null!==(s=null==z?void 0:z.generalDetails)&&void 0!==s?s:{},approvalWorkflowId:m,onSubmit:function(e){var t=Q(Q({},z),{},{generalDetails:e});J(t),ce(!0)},"data-componentid":"".concat(b,"-general-details-form")})),u.createElement(v.Z,{className:"divider-container"}),u.createElement("div",{className:"workflow-association-operations"},u.createElement(_.Z,{ref:P,isReadOnly:S||!O,initialValues:q,onSubmit:function(e){var t,o=e.matchedOperations.map((function(e){return e.value})),n=o.filter((function(e){return!X.some((function(t){return t.operation===e}))})),r=X.filter((function(e){return!o.includes(e.operation)})),a=M(n);try{for(a.s();!(t=a.n()).done;){var i=t.value,l="Association for ".concat(i);ke({associationName:l,operation:i,workflowId:m})}}catch(f){a.e(f)}finally{a.f()}var c,s=M(r);try{for(s.s();!(c=s.n()).done;){var u=c.value;be(u.associationId)}}catch(f){s.e(f)}finally{s.f()}},onChange:function(e){fe(!e||0===e.length)},"data-componentid":"".concat(b,"-general-details-form"),isEditPage:!0,workflowId:m})),u.createElement(v.Z,{className:"divider-container"}),u.createElement("div",{className:"workflow-model-configuration-settings"},u.createElement(g.Z,{className:"operations-autocomplete-header"},u.createElement(c.X6,{as:"h6"},"Approval Steps")),u.createElement(U.Z,{ref:V,isReadOnly:S||!O,initialValues:re,onSubmit:function(e){if(e.approvalSteps.some((function(e){return 0===e.users.length&&0===e.roles.length})))return oe(!0),void ae(e);oe(!1),function(e){var t=Q(Q({},z),{},{configurations:e});J(t),we(t)}(e)},hasErrors:te,isEditPage:!0,"data-componentid":"".concat(b,"-configurations-form")})),u.createElement(c.KM,{type:"submit",disabled:S||!O||ue,onClick:function(){var e,t,o;(null==I||null===(e=I.current)||void 0===e?void 0:e.isFormEdited())?I.current.triggerSubmit():null==V||null===(o=V.current)||void 0===o||o.triggerSubmit(),null==P||null===(t=P.current)||void 0===t||t.triggerSubmit()},"data-componentid":"".concat(b,"-update-button")},W("common:update")))),u.createElement(c.v9,{sectionHeader:W("common:dangerZone"),"data-componentid":"".concat(b,"-danger-zone-group")},u.createElement(c.cN,{actionTitle:W("approvalWorkflows:form.dangerZone.delete.actionTitle"),header:W("approvalWorkflows:form.dangerZone.delete.header"),subheader:W("approvalWorkflows:form.dangerZone.delete.subheader"),onActionClick:function(){return F(!0)},"data-componentid":"".concat(b,"-danger-zone"),isButtonDisabled:S||!R})),N&&u.createElement(c.cV,{"data-componentid":"".concat(b,"-delete-confirmation-modal"),onClose:function(){return F(!1)},type:"negative",open:N,assertionHint:W("roles:list.confirmations.deleteItem.assertionHint"),assertionType:"checkbox",primaryAction:"Confirm",secondaryAction:"Cancel",onSecondaryActionClick:function(){return F(!1)},onPrimaryActionClick:function(){!function(e){(0,Z.Yz)(e).then((function(){he({description:W("approvalWorkflows:notifications.deleteApprovalWorkflow.success.description"),level:i.QU.SUCCESS,message:W("approvalWorkflows:notifications.deleteApprovalWorkflow.success.message")}),a.m.push(r.$.getPaths().get("APPROVAL_WORKFLOWS"))})).catch((function(){he({description:W("approvalWorkflows:notifications.deleteApprovalWorkflow.genericError.description"),level:i.QU.ERROR,message:W("approvalWorkflows:notifications.deleteApprovalWorkflow.genericError.message")})}))}(m),F(!1)},closeOnDimmerClick:!1},u.createElement(c.cV.Header,{"data-componentid":"".concat(b,"-delete-confirmation-modal-header")},W("roles:list.confirmations.deleteItem.header")),u.createElement(c.cV.Message,{attached:!0,negative:!0,"data-componentid":"".concat(b,"-delete-confirmation-modal-message")},W("roles:list.confirmations.deleteItem.message",{type:"approval workflow"})),u.createElement(c.cV.Content,{"data-componentid":"".concat(b,"-delete-confirmation-modal-content")},W("roles:list.confirmations.deleteItem.content",{type:"approval workflow"}))))};function K(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var n,r,a,i,l=[],c=!0,s=!1;try{if(a=(o=o.call(e)).next,0===t){if(Object(o)!==o)return;c=!1}else for(;!(c=(n=a.call(o)).done)&&(l.push(n.value),l.length!==t);c=!0);}catch(e){s=!0,r=e}finally{try{if(!c&&null!=o.return&&(i=o.return(),Object(i)!==i))return}finally{if(s)throw r}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return X(e,t);var o={}.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?X(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function X(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,n=Array(t);o<t;o++)n[o]=e[o];return n}const B=function(e){var t,o,v=e.match,g=e["data-componentid"],w=void 0===g?"approval-workflow-edit-page":g,y=(0,p.I0)(),h=(0,f.$)().t,k=null===(t=v.params.id)||void 0===t?void 0:t.split("#")[0],b=(0,p.v9)((function(e){var t;return null==e||null===(t=e.config)||void 0===t||null===(t=t.ui)||void 0===t||null===(t=t.features)||void 0===t?void 0:t.workflows})),E=(0,n.EV)(null==b||null===(o=b.scopes)||void 0===o?void 0:o.update),W=K((0,u.useState)(null),2),S=W[0],A=W[1],O=function(e){var t,o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n={headers:{Accept:"application/json","Content-Type":"application/json"},method:i.f2.GET,url:"".concat(null===(t=m.h.getState())||void 0===t||null===(t=t.config)||void 0===t||null===(t=t.endpoints)||void 0===t?void 0:t.workflows,"/").concat(e)},r=(0,d.Z)(o?n:null);return{data:r.data,error:r.error,isLoading:r.isLoading,isValidating:r.isValidating,mutate:r.mutate}}(k,!(0,s.Z)(k)),R=O.data,j=O.isLoading,I=O.error,P=O.mutate;(0,u.useEffect)((function(){I&&y((0,l.V_)({description:h("approvalWorkflows:notifications.fetchApprovalWorkflows.genericError.description"),level:i.QU.ERROR,message:h("approvalWorkflows:notifications.fetchApprovalWorkflows.genericError.message")}))}),[I]),(0,u.useEffect)((function(){A(R)}),[R]);return u.createElement(c.Xg,{"data-componentid":"".concat(w,"-page-layout"),pageTitle:h("approvalWorkflows:pageLayout.edit.title"),title:u.createElement(u.Fragment,null,null==R?void 0:R.name),description:u.createElement(u.Fragment,null,null==R?void 0:R.description),backButton:{onClick:function(){a.m.push(r.$.getPaths().get("APPROVAL_WORKFLOWS"))},text:h("approvalWorkflows:pageLayout.edit.back")},image:u.createElement(c.Xo,{name:null==R?void 0:R.name,size:"tiny",floated:"left"}),bottomMargin:!1,contentTopMargin:!0,pageHeaderMaxWidth:!1},u.createElement(J,{"data-componentid":"".concat(w,"-edit-layout"),approvalWorkflowDetails:S,approvalWorkflowId:k,isReadOnly:!E,mutateApprovalWorkflowDetails:function(){P()},isLoading:j}))}},37883:(e,t,o)=>{o.d(t,{Z:()=>l});var n=o(81611),r=o.n(n),a=o(83948),i=o.n(a)()(r());i.push([e.id,".workflow-model-general-settings{display:flex;flex-direction:column;gap:16px;margin-bottom:20px;margin-left:5px}.workflow-association-operations{display:flex;flex-direction:column;margin-bottom:15px;margin-left:5px;margin-top:15px}.workflow-model-configuration-settings{margin-top:20px;margin-left:5px;margin-bottom:20px}.workflow-model-configuration-settings .operations-autocomplete-header{margin-bottom:5px}.workflow-model-configuration-settings .operations-autocomplete-header h6{color:#666}",""]);const l=i}}]);