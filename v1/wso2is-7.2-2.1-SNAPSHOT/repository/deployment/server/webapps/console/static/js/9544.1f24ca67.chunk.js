"use strict";(self.webpackChunk_wso2is_console=self.webpackChunk_wso2is_console||[]).push([[9544],{39203:(e,t,n)=>{n.d(t,{Ug:()=>u,VL:()=>c,fF:()=>d,hI:()=>l,sS:()=>g,tN:()=>p,yq:()=>m});var r=n(2292),o=n(96124),i=n(76271),a=n(6833),s=r.AsgardeoSPAClient.getInstance().httpRequest.bind(r.AsgardeoSPAClient.getInstance()),l=function(e,t){var n={headers:{"Access-Control-Allow-Origin":i.h.getState().config.deployment.clientHost,"Content-Type":"application/json"},method:a.f2.GET,params:{domain:e,excludedAttributes:t},url:i.h.getState().config.endpoints.groups};return s(n).then((function(e){if(200==e.status)return Promise.resolve(e)})).catch((function(e){return Promise.reject(e)}))},u=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,l=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],u={headers:{"Content-Type":"application/json"},method:a.f2.GET,params:{count:e,domain:r,excludedAttributes:s,filter:n,startIndex:t},url:i.h.getState().config.endpoints.groups},c=(0,o.Z)(l?u:null),d=c.data,p=c.error;return{data:d,error:p,isLoading:!p&&!d,isValidating:c.isValidating,mutate:c.mutate,response:c.response}},c=function(e,t){var n={headers:{"Access-Control-Allow-Origin":i.h.getState().config.deployment.clientHost,"Content-Type":"application/json"},method:a.f2.GET,params:{excludedAttributes:t},url:i.h.getState().config.endpoints.groups+"/"+e};return s(n).then((function(e){return Promise.resolve(e)})).catch((function(e){return Promise.reject(e)}))},d=function(e,t){var n={data:t,headers:{"Access-Control-Allow-Origin":i.h.getState().config.deployment.clientHost,"Content-Type":"application/json"},method:a.f2.PATCH,url:i.h.getState().config.endpoints.groups+"/"+e};return s(n).then((function(e){return Promise.resolve(e)})).catch((function(e){return Promise.reject(e)}))},p=function(e){var t={data:e,headers:{"Access-Control-Allow-Origin":i.h.getState().config.deployment.clientHost,"Content-Type":"application/json"},method:a.f2.POST,url:i.h.getState().config.endpoints.groups+"/.search"};return s(t).then((function(e){return Promise.resolve(e)})).catch((function(e){return Promise.reject(e)}))},m=function(e){var t={headers:{"Access-Control-Allow-Origin":i.h.getState().config.deployment.clientHost,"Content-Type":"application/json"},method:a.f2.DELETE,url:i.h.getState().config.endpoints.groups+"/"+e};return s(t).then((function(e){return Promise.resolve(e)})).catch((function(e){return Promise.reject(e)}))},g=function(e){var t={data:e,headers:{"Access-Control-Allow-Origin":i.h.getState().config.deployment.clientHost,"Content-Type":"application/json"},method:a.f2.POST,url:i.h.getState().config.endpoints.groups};return s(t).then((function(e){return Promise.resolve(e)})).catch((function(e){return Promise.reject(e)}))}},9544:(e,t,n)=>{n.d(t,{V:()=>V});var r=n(2292),o=n(6833),i=n(76271),a=r.AsgardeoSPAClient.getInstance().httpRequest.bind(r.AsgardeoSPAClient.getInstance()).bind(r.AsgardeoSPAClient.getInstance()),s=n(48704),l=n(39203),u=n(7231),c=n(10319),d=n(82406),p=n(16590),m=n(20494),g=n(55495),f=n(50699),h=n(44194),v=n(10479),y=n(47245),b=n(47018),S=n(89141),E=n(86989),C=n(25134),P=n(13550),A=n(90302),O=n(51021),U=n(12638),w=n(37077),j=n(26154),L=n(62508);n(84702);function T(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,s=[],l=!0,u=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=i.call(n)).done)&&(s.push(r.value),s.length!==t);l=!0);}catch(e){u=!0,o=e}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return I(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?I(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var R=function(e){var t=e.user,n=e.isLoading,r=e.isReadOnly,i=e.handleOpenAddNewGroupModal,a=e.handleUserUpdate,s=e["data-componentid"],u=void 0===s?"edit-user-groups":s,c=(0,v.$)().t,p=(0,y.I0)(),g=T((0,h.useState)(""),2),b=g[0],S=g[1],I=T((0,h.useState)(A.r.DEFAULT_RESOURCE_LIST_ITEM_LIMIT),2),R=I[0],G=I[1],k=T((0,h.useState)(0),2),N=k[0],Z=k[1],x=T((0,h.useState)(void 0),2),H=x[0],M=x[1],_=T((0,h.useState)(!1),2),V=_[0],D=_[1],F=T((0,h.useState)(!1),2),Q=F[0],q=F[1],z=T((0,h.useState)(void 0),2),$=z[0],J=z[1],X=T((0,h.useState)(!1),2),B=X[0],K=X[1],Y=null==t?void 0:t.groups;(0,h.useEffect)((function(){ee(0,R,Y,b)}),[t,b]);var W,ee=function(e,t,n,r){if(n)if((0,f.Z)(r))M(null==n?void 0:n.slice(e,t+e));else{var o=n.filter((function(e){return e.display.toLowerCase().includes(r.toLowerCase())}));M(null==o?void 0:o.slice(e,t+e))}else M([])},te=function(){D(!V),S("")};return h.createElement(m.pJ,{className:"list-user-roles-section","data-testid":"user-mgt-groups-list",padded:"very"},h.createElement(E.Z,{display:"flex",justifyContent:"space-between",alignItems:"center"},(!!b||(null==H?void 0:H.length)>0)&&h.createElement("div",null,h.createElement(m.X6,{as:"h4"},c("user:updateUser.groups.editGroups.heading")),h.createElement(m.X6,{subHeading:!0,ellipsis:!0,as:"h6"},c("user:updateUser.groups.editGroups.subHeading"))),!r&&(!!b||(null==H?void 0:H.length)>0)&&h.createElement(m.KM,{"data-testid":"user-mgt-groups-list-update-button",onClick:i},h.createElement(j.Z,{name:"plus"}),c("applicationRoles:roleGroups.assignGroup"))),h.createElement(L.Z,{hidden:!0}),h.createElement(m.PS,{advancedSearch:h.createElement(C.n,{"data-testid":"group-mgt-groups-list-advanced-search",onFilter:function(e){return S(null==e?void 0:e.trim())},disableSearchFilterDropdown:!0,filterAttributeOptions:[],placeholder:c("console:manage.features.groups.advancedSearch.placeholder"),defaultSearchAttribute:"",defaultSearchOperator:"",triggerClearQuery:V}),currentListSize:null==H?void 0:H.length,listItemLimit:R,onItemsPerPageDropdownChange:function(e,t){G(t.value),ee(N,t.value,Y)},"data-componentid":"".concat(u,"-user-groups-list-layout"),"data-testid":"".concat(u,"-user-groups-list-layout"),onPageChange:function(e,t){var n=(t.activePage-1)*R;Z(n),ee(n,R,Y)},showPagination:!0,totalPages:Math.ceil((null==Y?void 0:Y.length)/R),totalListSize:null==Y?void 0:Y.length,showPaginationPageLimit:!r,showTopActionPanel:!!b||(null==Y?void 0:Y.length)>0},h.createElement(m.wQ,{isLoading:n,loadingStateOptions:{count:A.r.DEFAULT_RESOURCE_LIST_ITEM_LIMIT,imageType:"circular"},actions:[{"data-componentid":"".concat(u,"-user-list-item-delete-button"),"data-testid":"".concat(u,"-user-list-item-delete-button"),hidden:function(){return r},icon:function(){return"trash alternate"},onClick:function(e,t){J(t),q(!0)},popupText:function(){return c("common:delete")},renderer:"semantic-icon"}],columns:(W=[{allowToggleVisibility:!1,dataIndex:"groupName",id:"groupName",key:"groupName",render:function(e){var n,r=null==e||null===(n=e.display)||void 0===n?void 0:n.split("/"),o=1===r.length?r[0]:r[1];return h.createElement(U.Z,{image:!0,as:"h6",className:"header-with-icon","data-componentid":"".concat(u,"-item-heading")},h.createElement(m.Yt,{"data-componentid":"users-list-item-image",name:e.display,size:"mini",image:t.profileUrl,spaced:"right","data-hj-suppress":""}),h.createElement("div",null,o))},title:h.createElement("div",{className:"pl-3"},c("user:updateUser.groups.editGroups.groupList.headers.1"))},{allowToggleVisibility:!1,dataIndex:"domain",id:"domain",key:"domain",render:function(e){var t,n=null==e||null===(t=e.display)||void 0===t?void 0:t.split("/"),r=1===n.length?O.wO.primaryUserstoreName:n[0];return h.createElement(U.Z,{image:!0,as:"h6",className:"header-with-icon","data-componentid":"".concat(u,"-item-heading")},h.createElement(w.Z,{size:"mini"},r))},title:h.createElement("div",{className:"pl-3"},c("user:updateUser.groups.editGroups.groupList.headers.0"))}],W.push({allowToggleVisibility:!1,dataIndex:"action",id:"actions",key:"actions",textAlign:"right",title:""}),W),data:H,onRowClick:function(){return null},placeholders:b?h.createElement(m.$J,{action:h.createElement(m.Qj,{onClick:te},c("users:usersList.search.emptyResultPlaceholder.clearButton")),image:(0,P.jF)().emptySearch,imageSize:"tiny","data-testid":"user-mgt-empty-groups-list",title:c("user:updateUser.groups.editGroups.groupList.emptyListPlaceholder.title"),subtitle:[c("roles:list.emptyPlaceholders.search.subtitles.0",{searchQuery:b}),c("roles:list.emptyPlaceholders.search.subtitles.1")]}):0===(null==H?void 0:H.length)?h.createElement(m.$J,{"data-testid":"user-mgt-empty-groups-list",title:c("user:updateUser.groups.editGroups.groupList.emptyListPlaceholder.title"),subtitle:[c("user:updateUser.groups.editGroups.groupList.emptyListPlaceholder.subTitle.0"),c("user:updateUser.groups.editGroups.groupList.emptyListPlaceholder.subTitle.1"),c("user:updateUser.groups.editGroups.groupList.emptyListPlaceholder.subTitle.2")],action:!r&&h.createElement(m.KM,{"data-testid":"user-mgt-empty-groups-list-assign-group-button",onClick:i,loading:n,disabled:n},h.createElement(j.Z,{name:"plus"}),c("applicationRoles:roleGroups.assignGroup")),image:(0,P.jF)().emptyList,imageSize:"tiny"}):null,selectable:!1,showHeader:!0,"data-testid":u})),h.createElement(m.cV,{primaryActionLoading:B,"data-componentid":"".concat(u,"-confirmation-modal"),onClose:function(){return q(!1)},type:"negative",open:Q,primaryAction:c("common:confirm"),secondaryAction:c("common:cancel"),onSecondaryActionClick:function(){q(!1)},onPrimaryActionClick:function(){var e,n;K(!0),e=$,n={Operations:[{op:"remove",path:"members[value eq ".concat(t.id,"]")}],schemas:["urn:ietf:params:scim:api:messages:2.0:PatchOp"]},(0,l.fF)(e.value,n).then((function(){p((0,d.V_)({description:c("console:manage.features.groups.notifications.updateGroup.success.description"),level:o.QU.SUCCESS,message:c("console:manage.features.groups.notifications.updateGroup.success.message")})),a(t.id)})).catch((function(){p((0,d.V_)({description:c("console:manage.features.groups.notifications.updateGroup.error.description"),level:o.QU.ERROR,message:c("console:manage.features.groups.notifications.updateGroup.error.message")}))})).finally((function(){K(!1),J(void 0),q(!1)}))},closeOnDimmerClick:!1},h.createElement(m.cV.Header,{"data-componentid":"".concat(u,"-confirmation-modal-header")},c("users:confirmations.unassignGroup.header")),h.createElement(m.cV.Content,{"data-componentid":"".concat(u,"-confirmation-modal-content")},c("users:confirmations.unassignGroup.content"))))};function G(e){return G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},G(e)}function k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function N(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?k(Object(n),!0).forEach((function(t){Z(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Z(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=G(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=G(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==G(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function x(e){return function(e){if(Array.isArray(e))return _(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||M(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function H(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,s=[],l=!0,u=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=i.call(n)).done)&&(s.push(r.value),s.length!==t);l=!0);}catch(e){u=!0,o=e}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}(e,t)||M(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function M(e,t){if(e){if("string"==typeof e)return _(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_(e,t):void 0}}function _(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var V=function(e){var t,n=e.onAlertFired,r=e.user,E=e.handleUserUpdate,C=e.isReadOnly,P=(0,y.v9)((function(e){var t;return null==e||null===(t=e.config)||void 0===t||null===(t=t.ui)||void 0===t?void 0:t.primaryUserStoreDomainName})),A=(0,v.$)().t,O=(0,y.I0)(),U=H((0,h.useState)([]),2),w=U[0],j=U[1],L=H((0,h.useState)(!1),2),T=L[0],I=L[1],G=H((0,h.useState)(!1),2),k=G[0],Z=G[1],M=H((0,h.useState)(!1),2),_=M[0],V=M[1],D=H((0,h.useState)(null),2),F=D[0],Q=D[1],q=(null==r||null===(t=r.userName)||void 0===t||null===(t=t.split("/"))||void 0===t?void 0:t.length)>1?r.userName.split("/")[0]:s.w.primaryUserstoreName,z=(0,l.Ug)(null,null,F,q),$=z.data,J=z.error,X=z.isLoading,B=z.isValidating,K=(0,h.useMemo)((function(){if(null!=$&&$.Resources){var e=[];return $.Resources.map((function(t){var n,o=!1;(null==r||null===(n=r.groups)||void 0===n?void 0:n.length)>0&&r.groups.forEach((function(e){e.display===t.displayName&&(o=!0)})),o||e.push(t)})),e}return[]}),[$]),Y=(0,h.useMemo)((function(){return X||B}),[X,B]);(0,h.useEffect)((function(){if(J){if(J.response&&J.response.data&&J.response.data.description)return void O((0,d.V_)({description:J.response.data.description,level:o.QU.ERROR,message:A("console:manage.features.roles.edit.groups.notifications.fetchError.message")}));O((0,d.V_)({description:A("console:manage.features.roles.edit.groups.notifications.fetchError.description"),level:o.QU.ERROR,message:A("console:manage.features.roles.edit.groups.notifications.fetchError.message")}))}}),[J]);var W=function(){j(k?[]:K),Z(!k)},ee=function(){Z(!1),I(!1)},te=(0,h.useCallback)((0,g.Z)((function(e,t){(0,f.Z)(t.trim())?Q(null):Q("displayName co "+t)}),1e3),[]),ne=function(e,t){if(0!==(null==t?void 0:t.length)&&e){var r,s,l={Operations:[],schemas:["urn:ietf:params:scim:api:messages:2.0:BulkRequest"]},u=[],c={data:{Operations:[{op:"add",value:{members:[{display:e.userName,value:e.id}]}}]},method:"PATCH"};t.map((function(e){c=N(N({},c),{path:"/Groups/"+e.id}),u.push(c)})),u.map((function(e){l.Operations.push(e)})),V(!0),(r=l,s={data:r,headers:{"Content-Type":"application/json"},method:o.f2.POST,url:i.h.getState().config.endpoints.bulk},a(s).then((function(e){var t,n,r=null==e?void 0:e.data,o=!0;return null!=r&&null!==(t=r.schemas)&&void 0!==t&&t.includes("urn:ietf:params:scim:api:messages:2.0:BulkResponse")&&(null==r||null===(n=r.Operations)||void 0===n||n.some((function(e){var t,n=null==e||null===(t=e.status)||void 0===t?void 0:t.code;if(200!==n&&201!==n&&204!==n)return o=!1,!1}))),o?Promise.resolve(e):Promise.reject(e)})).catch((function(e){return Promise.reject(e)}))).then((function(){n({description:A("user:updateUser.groups.notifications.updateUserGroups.success.description"),level:o.QU.SUCCESS,message:A("user:updateUser.groups.notifications.updateUserGroups.success.message")}),ee(),E(e.id)})).catch((function(e){var t,r,i,a;404!==(null==e||null===(t=e.response)||void 0===t?void 0:t.status)&&(null!=e&&e.response&&null!=e&&null!==(r=e.response)&&void 0!==r&&r.data&&null!=e&&null!==(i=e.response)&&void 0!==i&&null!==(i=i.data)&&void 0!==i&&i.description?n({description:null===(a=e.response)||void 0===a||null===(a=a.data)||void 0===a?void 0:a.description,level:o.QU.ERROR,message:A("user:updateUser.groups.notifications.updateUserGroups.error.message")}):n({description:A("user:updateUser.groups.notifications.updateUserGroups.genericError.description"),level:o.QU.ERROR,message:A("user:updateUser.groups.notifications.updateUserGroups.genericError.message")}))})).finally((function(){V(!1)}))}},re=function(e){var t=null==e?void 0:e.split("/"),n={labelColor:"olive",labelText:p.StringUtils.isEqualCaseInsensitive(P,c.pH)?A("console:manage.features.users.userstores.userstoreOptions.primary"):P};return t[0]!==u.Fn&&t[0]!==u.eT&&(null==t?void 0:t.length)>1&&(n=N(N({},n),{},{labelText:t[0]})),n};return h.createElement(h.Fragment,null,h.createElement(R,{handleOpenAddNewGroupModal:function(){I(!0)},handleUserUpdate:E,isLoading:Y,isReadOnly:C,user:r}),h.createElement(b.Z,{"data-testid":"user-mgt-update-groups-modal",open:T,size:"small"},h.createElement(b.Z.Header,null,A("user:updateUser.groups.addGroupsModal.heading"),h.createElement(m.X6,{subHeading:!0,ellipsis:!0,as:"h6"},A("user:updateUser.groups.addGroupsModal.subHeading"))),h.createElement(b.Z.Content,null,h.createElement(m.IX,{selectionComponent:!0,searchPlaceholder:A("transferList:searchPlaceholder",{type:"Groups"}),handleUnelectedListSearch:function(e,t){var n=t.value;te(e,n)},"data-testid":"user-mgt-update-groups-modal",bordered:!1},h.createElement(m.Jv,{bordered:!1,isListEmpty:0===(null==K?void 0:K.length),isLoading:Y,listType:"unselected",listHeaders:[A("transferList:list.headers.0"),A("transferList:list.headers.1")],handleHeaderCheckboxChange:W,isHeaderCheckboxChecked:k,emptyPlaceholderContent:(0,f.Z)(F)?A("transferList:list.emptyPlaceholders.users.roles.searchForResults",{type:"groups"}):A("transferList:list.emptyPlaceholders.users.roles.unselected",{type:"groups"}),"data-testid":"user-mgt-update-groups-modal-unselected-groups-select-all-checkbox",emptyPlaceholderDefaultContent:A("transferList:list.emptyPlaceholders.default")},null==K?void 0:K.map((function(e,t){return h.createElement(m.qT,{handleItemChange:function(){return function(e){var t=(0,f.Z)(w)?[]:x(w),n=t.findIndex((function(t){return t.id===e.id}));-1!==n?t.splice(n,1):t.push(e),j(t),Z(t.length===K.length)}(e)},key:t,listItem:(n=null==e?void 0:e.displayName,o=null===(r=n)||void 0===r?void 0:r.split("/"),1!==(null==o?void 0:o.length)&&(n=o[1]),n),listItemId:null==e?void 0:e.id,listItemIndex:t,listItemTypeLabel:re(null==e?void 0:e.displayName),isItemChecked:-1!==w.findIndex((function(t){return t.id===e.id})),showSecondaryActions:!1,"data-testid":"user-mgt-update-groups-modal-unselected-groups"});var n,r,o}))))),h.createElement(b.Z.Actions,null,h.createElement(S.Z,null,h.createElement(S.Z.Row,{columns:2},h.createElement(S.Z.Column,{mobile:8,tablet:8,computer:8},h.createElement(m.Qj,{"data-testid":"user-mgt-update-groups-modal-cancel-button",floated:"left",onClick:ee},A("common:cancel"))),h.createElement(S.Z.Column,{mobile:8,tablet:8,computer:8},h.createElement(m.KM,{"data-testid":"user-mgt-update-groups-modal-save-button",floated:"right",loading:_,disabled:_||0===(null==w?void 0:w.length),onClick:function(){return ne(r,w)}},A("common:save"))))))))}}}]);